<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Scagnostics nD</title>
    <link href="css/styles.css" rel="stylesheet"/>
    <script src="lib/d3.js"></script>
    <script src="https://d3js.org/d3-color.v1.min.js"></script>
    <script src="https://d3js.org/d3-interpolate.v1.min.js"></script>
    <script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>
    <script src="build/js/scagnosticsnd.min.js"></script>
    <style>
        body {
            font-family: 'Open Sans', sans-serif;
            font-size: 14px;
            font-weight: 300;
            fill: #242424;
            text-align: left;
            text-shadow: 0 1px 0 #fff, 1px 0 0 #fff, -1px 0 0 #fff, 0 -1px 0 #fff;
            cursor: default;
        }

        .legend {
            font-family: 'Raleway', sans-serif;
            fill: #333333;
        }
    </style>
    <script charset="utf-8" src="lib/radarChart.js"></script>

</head>
<body>

<div class="radarChart" style="display: inline-flex;"></div>
<div id="controlButtons"></div>
<div id="msg" style="display: block;"></div>

<script>


</script>
<script>
    let scag = null;
    let data = null;
    let svgWidth = 1000;
    let svgHeight = 1000;
    let duration = 1000;
    let dataPointRadius = 2;
    let dataPointOpacity = 0.9;
    let binOpacity = 0.8;
    let size = 500;

    /***********RANDOM DATA*******************/
    let random = Math.random,
        points = [];
    let dim = 5;
    //100 data points
    for (let i = 0; i < 100; i++) {
        //each point of 10 dimensions
        let point = [];
        for (let j = 0; j < dim; j++) {
            point.push(random());
        }
        points.push(point);
    }
    //Push one extreme point
    points.push(d3.range(dim).map(d=>2));
    draw(points);

    //Displaying messages
    let msgContainer = "msg";
    displayScagScores(scag, msgContainer);

    function draw(points) {
        let scagOptions = {
            startBinGridSize: 30,
            minBins: 30,
            maxBins: 100,
            outlyingCoefficient: 0.5,
            incrementA: 1,
            incrementB: 5,
            decrementA: 0.9,
            decrementB: 0,
            distanceWeights: [1, 1, 1, 1, 1, 1, 1, 1, 1, 1]
        };
        // let scagOptions = {};
        scag = scagnosticsnd(points, scagOptions);
        let normalizedPoints = scag.normalizedPoints;
        let radarData = [];
        for (let i = 0; i < normalizedPoints.length; i++) {
            let point = {};
            point.axes = [];
            for (let j = 0; j < normalizedPoints[i].length; j++) {
                let item = {
                    axis: 'd' + j,
                    value: normalizedPoints[i][j]
                }
                point.axes.push(item);
            }
            radarData.push(point);
        }
        drawRadarChart(".radarChart", radarData);
    }

    function drawRadarChart(theDiv, radarData) {
        let margin = {top: 50, right: 80, bottom: 50, left: 80},
            width = Math.min(700, window.innerWidth / 4) - margin.left - margin.right,
            height = Math.min(width, window.innerHeight - margin.top - margin.bottom);
        let radarChartOptions = {
            w: 290,
            h: 350,
            margin: margin,
            maxValue: 1,
            levels: 5,
            roundStrokes: false,
            color: d3.scaleOrdinal(d3.schemeBlues[9]),
            format: '.0f',
            // legend: {title: 'Random dataset', translateX: 200, translateY: 40},

        };

        // Draw the chart, get a reference the created svg element :
        let svg_radar = RadarChart(theDiv, radarData, radarChartOptions);
        return svg_radar;
    }
    function displayScagScores(scag, msgContainer) {
        let msg = "Scagnostics";
        //Binning
        msg += "<br/>0. Bin size: " + scag.binSize + "x" + scag.binSize + " bins" + ", num of bins: " + scag.bins.length;
        //Outlying
        msg += "<br/>1. Outlying score: " + scag.outlyingScore + ", outlying edge cut point: " + scag.outlyingUpperBound;
        //Skewed
        msg += "<br/>2. Skewed score: " + scag.skewedScore;
        //Sparse
        msg += "<br/>3. Sparse score: " + scag.sparseScore;
        //Clumpy
        msg += "<br/>4. Clumpy score: " + scag.clumpyScore;
        //Striated
        msg += "<br/>5. Striated score: " + scag.striatedScore;
        //Convex
        msg += "<br/>6. Convex score: " + scag.convexScore;
        //Skinny
        msg += "<br/>7. Skinny score: " + scag.skinnyScore;
        //Stringy
        msg += "<br/>8. Stringy score: " + scag.stringyScore;
        //Monotonic
        msg += "<br/>9. Monotonic score: " + scag.monotonicScore;
        //Set the scagnostics message
        d3.select("#" + msgContainer).html(msg);
    }
</script>
</body>
</html>